# VPN Connectivity Incident ‚Äî MTU / NAT Issue

##  –ö–æ–Ω—Ç–µ–∫—Å—Ç
–í –ø—Ä–æ—Ü–µ—Å—Å–µ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ VPN –Ω–∞ –±–∞–∑–µ WireGuard
–±—ã–ª–∏ –≤—ã—è–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —Ç—Ä–∞—Ñ–∏–∫–∞ —É —á–∞—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.

–ò–Ω—Ü–∏–¥–µ–Ω—Ç –ø—Ä–æ—è–≤–ª—è–ª—Å—è –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ –∏ –∑–∞–≤–∏—Å–µ–ª –æ—Ç —Ç–∏–ø–∞ —Å–µ—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞
(–¥–æ–º–∞—à–Ω–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç / –º–æ–±–∏–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä).

---

##  –°–∏–º–ø—Ç–æ–º—ã
- WireGuard handshake —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è
- Ping –¥–æ VPN-—Å–µ—Ä–≤–µ—Ä–∞ –≤–æ–∑–º–æ–∂–µ–Ω
- –î–∞–ª—å–Ω–µ–π—à–∏–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–±–ª–µ–º–∞ —á–∞—â–µ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —É –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ NAT

---

##  –ü–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑
–ë—ã–ª–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:
- —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard (`wg show`)
- firewall-–ø—Ä–∞–≤–∏–ª–∞ (iptables)
- –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
- `AllowedIPs` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –∫–ª–∏–µ–Ω—Ç–µ

–û—á–µ–≤–∏–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—ã—è–≤–ª–µ–Ω–æ –Ω–µ –±—ã–ª–æ.

---

##  –ì–∏–ø–æ—Ç–µ–∑—ã
1. –û—à–∏–±–∫–∏ firewall / NAT  
2. –ü—Ä–æ–±–ª–µ–º—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏  
3. MTU mismatch –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ UDP-—Ç—Ä–∞—Ñ–∏–∫–∞  
4. –†–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π NAT  

---

##  –í—ã—è–≤–ª–µ–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞
–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π –æ–∫–∞–∑–∞–ª—Å—è **MTU mismatch** –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º UDP
- NAT –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º keepalive-–ø–∞–∫–µ—Ç–æ–≤

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:
- handshake –ø—Ä–æ—Ö–æ–¥–∏–ª —É—Å–ø–µ—à–Ω–æ
- —á–∞—Å—Ç—å –ø–∞–∫–µ—Ç–æ–≤ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å –∏–ª–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–ª–∞—Å—å
- —Ç—Ä–∞—Ñ–∏–∫ –Ω–µ –¥–æ—Ö–æ–¥–∏–ª –¥–æ –∫–æ–Ω–µ—á–Ω–æ–π —Ç–æ—á–∫–∏

---

## üõ† –ü—Ä–∏–Ω—è—Ç—ã–µ –º–µ—Ä—ã

### 1. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ MTU
- –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ MTU –¥–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü—Ä–∏–º–µ–Ω–µ–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è VPN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

---

### 2. PersistentKeepalive
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä:
- PersistentKeepalive = 25
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å NAT-—Å–µ—Å—Å–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã–º–∏

---

### 3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ `wg syncconf` –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ò—Å–∫–ª—é—á–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

## 4. –†–µ–∑—É–ª—å—Ç–∞—Ç
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª–æ—Å—å
- –¢—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏ NAT-—Å–µ—Ç—è—Ö

---

## 5. –í—ã–≤–æ–¥—ã
- –£—Å–ø–µ—à–Ω—ã–π handshake –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É —Ç—Ä–∞—Ñ–∏–∫–∞
- WireGuard —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ MTU –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö
- NAT + UDP —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–≥–æ keepalive
- –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –≤–∞–∂–Ω—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–î–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ reference
–¥–ª—è –±—É–¥—É—â–∏—Ö VPN-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–π.

